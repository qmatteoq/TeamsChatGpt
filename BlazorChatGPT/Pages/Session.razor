@page "/session"

@using Microsoft.SemanticKernel;
@using Microsoft.SemanticKernel.AI.ChatCompletion;
@using Microsoft.SemanticKernel.Connectors.AI.OpenAI.ChatCompletion;
@using Microsoft.SemanticKernel.KernelExtensions;
@using Microsoft.SemanticKernel.Orchestration;
@using Microsoft.SemanticKernel.SemanticFunctions;
@inject IConfiguration configuration;

<h3>Session</h3>

<div>Describe the topic of your session:</div>
<div><textarea rows="5" cols="100" @bind="@topic" /></div>

<select name="style" id="cars" @bind="@tone">
    <option value="professional">Professional</option>
    <option value="fun">Fun</option>
</select>

<button @onclick="() => GenerateBusinessMailAsync()">
    Send
</button>

<p class="markup">@((MarkupString)output)</p>

@code {

    private string topic;
    private string output;
    private string tone;

    public async Task GenerateBusinessMailAsync()
    {
        string apiKey = configuration["AzureOpenAI:ApiKey"];
        string deploymentName = configuration["AzureOpenAI:DeploymentName"];
        string endpoint = configuration["AzureOpenAI:Endpoint"];

        var kernel = Kernel.Builder.Build();
        kernel.Config.AddAzureChatCompletionService("chatgpt-azure", deploymentName, endpoint, apiKey, true);

        var skill = kernel.ImportSemanticSkillFromDirectory("Skills", "GeneratorSkill");
        var context = new ContextVariables();
        context.Set("topic", topic);
        context.Set("tone", tone);

        var result = await kernel.RunAsync(context, skill["SessionGeneratorFunction"]);

        if (!result.ErrorOccurred)
        {
            output = result.Result;
        }
        else
        {
            output = result.LastErrorDescription;
        }
    }
}